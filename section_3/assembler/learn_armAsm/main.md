## ARM7 ASM 


| 寄存器    | 用途                  |
| :----- | :------------------ |
| R0–R3  | 参数、返回值、临时变量         |
| R4–R11 | 保存用寄存器              |
| R12    | 临时寄存器 (IP)          |
| R13    | 栈指针 (SP)            |
| R14    | 链接寄存器 (LR)，保存函数返回地址 |
| R15    | 程序计数器 (PC)，当前指令地址   |


| 寄存器 | 常规用途 / 功能     | 说明                                     |
| --- | ------------- | -------------------------------------- |
| R0  | 参数 / 返回值      | 函数调用时第1个参数，也可存返回值；一般可自由使用              |
| R1  | 参数 / 临时值      | 函数调用时第2个参数；临时计算使用                      |
| R2  | 参数 / 临时值      | 函数调用时第3个参数；临时计算使用                      |
| R3  | 参数 / 临时值      | 函数调用时第4个参数；临时计算使用                      |
| R4  | 保存寄存器         | 通常用于保存跨函数调用的值（callee-saved）            |
| R5  | 保存寄存器         | 同上                                     |
| R6  | 保存寄存器         | 同上                                     |
| R7  | 保存寄存器 / 系统调用号 | 在 Linux ARM 中，R7 通常存系统调用号              |
| R8  | 保存寄存器         | 同上，callee-saved                        |
| R9  | 静态链 / 保存寄存器   | 也叫 SB（Static Base），可用作全局数据指针           |
| R10 | 保存寄存器         | 同上，callee-saved                        |
| R11 | 帧指针（FP）       | 用于函数栈帧，保存调用函数的栈指针（可选）                  |
| R12 | 临时寄存器（IP）     | Intra-Procedure-call scratch，函数调用内临时使用 |
| R13 | 栈指针（SP）       | 保存当前栈顶地址，所有函数都用它操作栈                    |
| R14 | 链接寄存器（LR）     | 保存返回地址，函数调用时自动保存返回点                    |
| R15 | 程序计数器（PC）     | 指向当前正在执行的指令地址，改变 PC 就跳转执行              |


arm7的语法
<指令> <条件> <目标寄存器>, <操作数1>, <操作数2>

ADD R0, R1, R2    ; R0 = R1 + R2
SUB R3, R3, #1    ; R3 = R3 - 1
MOV R0, #10       ; R0 = 10

条件码（Condition）可以控制指令是否执行，例如：

| 条件码 | 含义        |
| :-- | :-------- |
| EQ  | 等于 (Z=1)  |
| NE  | 不等于 (Z=0) |
| GT  | 大于        |
| LT  | 小于        |
| AL  | 总是执行（默认）  |


ADDEQ R0, R1, R2  ; 如果相等，则执行 R0 = R1 + R2


常见的数据操作指令


| 指令              | 含义           |
| :-------------- | :----------- |
| MOV             | 数据传送         |
| ADD/SUB         | 加法 / 减法      |
| MUL             | 乘法           |
| CMP             | 比较（更新标志位）    |
| AND / ORR / EOR | 按位与 / 或 / 异或 |
| LDR / STR       | 读内存 / 写内存    |


例子:

MOV R0, #5       ; R0 = 5
MOV R1, #3       ; R1 = 3
ADD R2, R0, R1   ; R2 = 8
SUB R3, R2, #1   ; R3 = 7

加载与存储（LDR / STR）

ARM 是 load/store 架构，即只有通过 LDR/STR 才能访问内存

LDR R0, =var     ; 加载变量地址到 R0
LDR R1, [R0]     ; 从地址 R0 读取内容到 R1
STR R2, [R0]     ; 把 R2 的内容写入地址 R0

STR R0, [R4], #4 ; 把 R0（32-bit）写入内存 R4 指向的地址 R4 自动加 4 字节 → 指向下一个 32-bit 的内存单元 

比如说R0 = 32, R4 = 0x1000
STR R0, [R4], #4 后
 [R4] = 32 
R4 = R4 + 4
R4 = 0x1004
下次调用R4的时候，指向的内存就是0x1004了




| 指令             | 英文含义               | 方向       | 逻辑含义                         |
| :------------- | :----------------- | :------- | :--------------------------- |
| `LDR R1, [R0]` | **Load Register**  | 内存 → 寄存器 | 从内存地址 `R0` 读取一个字（word）到 `R1` |
| `STR R2, [R0]` | **Store Register** | 寄存器 → 内存 | 把 `R2` 的内容写入地址 `R0` 指向的内存    |


分支与循环

B label           ; 无条件跳转
BEQ label         ; 相等时跳转
BNE label         ; 不等时跳转
BL func           ; 调用函数（保存返回地址到 LR）
BX LR             ; 返回

例子

MOV R0, #5
loop: ; 这个loop 是一个label
  SUBS R0, R0, #1    ; R0 = R0 - 1 并更新标志位
  BNE loop           ; 如果 R0 != 0 跳回 loop


| 项目      | Label（普通标签）      | 函数（Function）                 |
| ------- | ---------------- | ---------------------------- |
| 定义方式    | `loop:`、`start:` | `my_func:`                   |
| 调用方式    | `B label`（无条件跳转） | `BL func`（跳转并保存返回地址）         |
| 返回方式    | **没有返回机制**       | `BX LR` 或 `MOV PC, LR` 返回调用点 |
| 保存返回地址  | 不保存              | 保存在 **LR（Link Register）**    |
| 类比 C 语言 | `goto loop;`     | `func(); return;`            |
| 可以返回值吗  | 不直接返回            | 通常通过寄存器（R0）返回值               |



#number 表示立即数 相当于常量数字


SVC = Supervisor Call
SVC 的存在相当于从用户到系统，发起系统调用

MOV R7, #系统调用号   ; 放入系统调用号
MOV R0, #参数         ; 可选，传递系统调用参数
SVC #0                ; 触发系统调用

核心概念不变：SVC 始终是“从用户模式进入特权模式，执行内核/异常服务”，不同立即数只是给内核额外信息。


| 系统调用号 (R7) | 系统调用功能 (ARM Linux) |
| ---------- | ------------------ |
| 1          | `exit`             |
| 2          | `fork`             |
| 3          | `read`             |
| 4          | `write`            |
| 5          | `open`             |
| 6          | `close`            |
| 20         | `getpid`           |
| …          | …                  |
