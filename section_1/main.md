### GOAL
### 第1–3天：理解计算机的最底层
- [x] 了解晶体管的基本原理  
- [x] 理解 FPGA 是如何用晶体管实现逻辑的  
- [x] 学习 FPGA 的基本结构（LUT、布线、逻辑块）  
- [x] 明白 IC（集成电路）只是封装好的晶体管集合  

晶体管的基本原理
晶体管有三个元素构成
集点极(collector)    发射极(emitter) 
----                 ____
        基极(base)
        ____

基极不通电的情况下看作一个绝缘体, 通点后两端链接

与门(AND GATE) (icon: 󰣡 ): 
input   output
|0|0| = 0
|0|1| = 0
|1|0| = 0
|1|1| = 1
或门(OR GATE) (icon: 󰣥 ):
|0|0| = 0
|0|1| = 1
|1|0| = 1
|1|1| = 1
非门/反相器(NOT GATE) (icon: 󰣤 ):
input output
0       1
1       0
异或门(XOR GATE) (icon: 󰣧 )

|0|0| = 0
|0|1| = 1
|1|0| = 1
|1|1| = 0
    
逻辑门是晶体管组成的电路的抽象集合,帮助我们思考问题

加法器(ADDER): 
半加器(HALF ADDER):
不考虑进位
两个输入 + 两个输出

x + y -> sum, carry

相当于一个XOR门+一个AND门


| x | y | sum | carry |
| ------------- | -------------- | -------------- | ------------|
| 0  | 0 | 0 | 0 |
| 0 | 1 | 1 | 0 |
| 1 | 0 | 1 | 0 |
| 1 | 1 | 0 | 1 |

x, y 和 sum 之间是XOR门 

全加器(FULL ADDER):
考虑进位
上一个进位输出连接下一个输入
所以相加n个二进制数需要n个全加器

八位加法器(8-bit ADDER):

八位全加器封装起来 

A(八位数字) + B(八位数字) -> SUM(八位数字) + 溢出信号(本质上相当于进位) 

所以需要额外一个字节来存储输出(不能忽略否则可能导致严重后果)

相同的，可以通过逻辑门的组合抽象出减法器等等

二进制解码器(binary decoder)
给解码器一个n位二进制数，有2^n种组合，每种组合都对应这个特定的输出激活，其他的输出属于非激活状态

总的来说，当解码器收到输入时，有且只有一个输出为1,其他的都为0

所以，我们能够利用这个创建能从多个选项中进行选择的电路

算数逻辑单元(ALU)

汇编操作对应了相对的二进制数 
通过一系列规定，连接解码器，让计算机知道具体操作是什么

ALU会接受 输入值 和 操作码(告诉电路应该执行那种算数运算) 
会生成结果和附加信息(是负数？零？还是发生了溢出？)

--------

存储器

地址信号 →│ 地址译码器（Decoder）│──┐
         └───────────────┘  │
                            ▼
                      ┌──────────────┐
                      │ 存储阵列（Array）│
                      │（由许多bit单元组成）│
                      └──────────────┘
                            │
                            ▼
                    ┌────────────┐
                    │ 读写控制电路 │
                    └────────────┘
存储器的层次结构，计算机不会只有一种存储器

| 层级  | 名称              | 类型         | 特点       |
| --- | --------------- | ---------- | -------- |
| 顶层  | 寄存器（Register）   | 由触发器构成     | 极快，容量极小  |
| 第二层 | 高速缓存（Cache）     | SRAM       | 速度快，容量小  |
| 第三层 | 主存（Main Memory） | DRAM       | 速度中等，容量大 |
| 底层  | 外存（Storage）     | Flash / 磁盘 | 速度慢，容量巨大 |


写入

CPU 发出地址 + 数据 → 地址译码器选中目标单元 → 写入晶体管状态改变 → 存储 0/1

读取


CPU 发出地址 → 地址译码器选中目标单元 → 读出晶体管当前状态 → 返回 0/1

--------
FPGA（现场可编程门阵列）:

FPGA 的核心是一个个 逻辑单元（Logic Cell），而逻辑单元内部的关键部分是 查找表（LUT）。

Top -> Down

FPGA -> Logic Cell -> LUT(查找表)

LUT = Decoder（输入选择） + SRAM（存储逻辑结果） + 多路选择器（Mux）/ 感测电路

SRAM(静态随机存取存储器):
常用的是 6T SRAM(六个晶体管) 由两对交叉耦合反相器(NOT GATE)（4 个晶体管）和两颗访问晶体管（access transistors）组成。


LUT(Lookup Table): 
本质上就是把布尔函数“表格化”后存起来的一个小型只读表（或可写的表）。
意思就是有函数存在SRAM里，需要一个Decoder去选择到底是哪个，还要一个Mux来选择输出哪个

因此，LUT 可以实现任意n输入组合逻辑：只要把对应的 2^n 个输出位写进 LUT，LUT 就按预期映射输入到输出。

在实际 FPGA（比如常见的 4-LUT、6-LUT）中，LUT 的每个存储位通常由 6T SRAM bitcell 存储（由晶体管实现），译码与 MUX 由组合逻辑（晶体管阵列）实现。


常见 LUT 大小：4-LUT（4 输入）、6-LUT（6 输入）。
n-LUT 能实现任意n-输入的布尔函数。

FPGA 是“可编程”的逻辑电路

FPGA 设计的核心目标是：

不预先决定放什么门，而让用户“下载配置”后再决定它是什么逻辑门。

LUT 是一个可编程查表器，SRAM 存储表格值，而不是具体电路。通过表格的内容，我们可以实现任意逻辑函数，包括 XOR、AND、OR……

LUT 的配置过程

| 来源       | 说明                                               |
| -------- | ------------------------------------------------ |
| 外部 Flash | 常见 FPGA 通过 SPI/Parallel Flash 存储 bitstream，上电时加载 |
| 主机下载     | 开发板上 FPGA 通过 JTAG 或 USB 接口下载 bitstream           |
| 内部控制器    | 某些 SoC FPGA 有内部微控制器或配置逻辑生成 bitstream             |

 bitstream = 一大串二进制数据，每个位对应 FPGA 内部某个 LUT/FF/IO 的配置位。

┌─────────────┐
│ 写 HDL 代码 │
│ (Verilog/VHDL) │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│ 综合 (Synthesis) │
│ HDL → LUT/FF 网表 │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│ 布局布线 (Place & Route) │
│ 决定 LUT/FF/互连位置 │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│ 比特流生成 │
│ Bitstream：每个 LUT/SRAM/FF/IO 的配置位 │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│ 下载比特流到 FPGA │
│ FPGA 上电 → 配置逻辑写入 LUT/SRAM/FF │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│ LUT 工作 │
│ 输入 → Decoder → SRAM 查表 → 输出 │
│ FPGA 逻辑功能实现 │
└─────────────┘

SRAM 存储的不是门电路，而是输入对应的输出值

Decoder + MUX 做查表操作

不同 SRAM 配置 → 同一 LUT 实现不同逻辑功能

所以其实LUT就相当于翻书查表，只是说，我可以通过改里面的SRAM的值得到不同的结果，相当于翻不同的📖查不同的表

--------

FPGA 的原理:

核心理念：出厂后硬件结构固定，但逻辑功能可由用户随意配置

核心原理：可编程逻辑 + 可编程互连

FPGA 内部包含：

> 逻辑单元（Logic Block / CLB）
>> 由 LUT + 触发器/寄存器 构成
>> LUT 实现任意组合逻辑，寄存器实现存储/状态保持

> 可编程互连网络（Programmable Interconnect）
>> LUT、寄存器、IO 之间通过可配置开关互连
>> 配置由 bitstream 控制

> 输入输出单元（IO Block）
>> 控制 FPGA 与外部世界信号的接口
>>可配置成不同电压标准、方向、驱动能力

>配置存储单元 / 配置逻辑
>>存储 bitstream，让 FPGA 各单元可编程

可编程互连就像 FPGA 内部的电线网，每条线都有开关，可以打开或关闭，把不同的逻辑单元连接起来。

FPGA = 一块由可编程逻辑单元（LUT+寄存器）和可编程互连组成的可重构芯片，通过比特流配置，可以实现任意数字电路功能

CLB

CLB 不完全是单个逻辑门，而是由 LUT（可以实现任意逻辑函数）和寄存器组成的逻辑模块。

可以理解成

逻辑门 = 基本砖块

CLB(Configurable Logic Block，可配置逻辑块) = 积木块，由 LUT/寄存器组合，可以实现任意组合逻辑或时序逻辑

可以把 FPGA 想象成一个 乐高积木板：

每块积木 = LUT + 寄存器

积木板上的小孔 = 互连节点

插在孔里的小桥 = 可控开关（开关矩阵）

不同的桥组合 → 积木之间可以搭建出任意电路

可编程互连 = 连接积木的桥，控制桥的开闭就能实现各种电路连接。

FPGA 内部每个 IO Block（IOB）可以连接到 CLB / LUT / 寄存器。

内部逻辑单元的输出可以通过 可编程互连 到达 IO，或者 IO 的输入信号可以进入 CLB。

这就是 FPGA 内部信号在逻辑单元和 IO 之间自由流动的基础。

总结

FPGA: 

LUT + 寄存器 = 可编程逻辑单元（功能模块）

可编程互连 = 将功能模块连接成电路的可控网络

比特流 = 决定 LUT 功能 + 决定互连开关状态

FPGA 的灵活性 = LUT 功能 + 可编程互连

FPGA 是由 CLB（LUT + 寄存器）、可编程互连（线+开关） 和 配置单元 组成的可重构芯片。
CLB 的逻辑功能由 LUT 的 SRAM 值 决定，比特流写入这些 SRAM 和开关配置，实现 FPGA 内各单元的逻辑和互联。
可编程互连通过开关控制单元间连接，使信号流向可变，从而实现任意逻辑功能, 还有用IO单元输出。


                   ┌───────────────┐
                   │   配置单元    │  ← 负责读取比特流，配置 CLB 和互连
                   └───────┬───────┘
                           │
                           ▼
┌───────────────┐      ┌───────────────┐      ┌───────────────┐
│       CLB      │────▶ │       CLB      │────▶ │       CLB      │
│ ┌───────────┐ │      │ ┌───────────┐ │      │ ┌───────────┐ │
│ │   LUT +   │ │      │ │   LUT +   │ │      │ │   LUT +   │ │
│ │ 寄存器/FF │ │      │ │ 寄存器/FF │ │      │ │ 寄存器/FF │ │
│ └───────────┘ │      │ └───────────┘ │      │ └───────────┘ │
└───────┬───────┘      └───────┬───────┘      └───────┬───────┘
        │                      │                      │
        ▼                      ▼                      ▼
     ┌───────────┐        ┌───────────┐        ┌───────────┐
     │ 互联开关矩阵 │  ← 可编程互连，控制信号从哪条线到哪条线
     └───────────┘        └───────────┘        └───────────┘
        │                      │                      │
        ▼                      ▼                      ▼
      输出 / 连接到其他 CLB / IO

--------

IC(集成电路)

IC 的本质：晶体管、电阻、电容等电子元件的集合

功能：数字/模拟/混合信号处理，取决于内部电路设计

实现：晶体管 → 逻辑门 → 模块 → 芯片封装

外观：封装好的黑盒，输入输出接口固定

可编程性：普通 IC 功能固定，FPGA IC(FPGA 也是一个IC) 功能可由比特流改变



